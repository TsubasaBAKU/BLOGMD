---
title: Linux笔记：开机流程与主要启动记录区MBR
date: 2016-06-08 23:26:41
tags:
	- 开机流程
	- Linux
categories:
	- LINUX
---
# 开机流程

这里我们需要首先提出一个概念：BIOS。BIOS是写在计算机主板上的一个韧体（韧体就是写入硬件的软件程序），BIOS就是在启动的时候，计算机主动执行的第一个程序了。
<!--more-->

接下来BIOS会分析计算机里有哪些存储设备，我们以硬盘为例，BIOS会找到能够启动的第一个硬盘，并且找到这个硬盘的第一个扇区的MBR(主引导分区)，在仅有446字节的MBR中有基本的启动管理程序，之后就是这个启动管理程序的工作了。

**这个启动管理程序的目的就是加载核心文件。**由于这个程序是操作系统安装时放入的，所以它能够识别硬盘内文件系统的格式，也就能够加载核心文件，之后就是操作系统的任务了。

在这里我们做几点总结：
**1. BIOS：是写在硬盘上的韧体，是计算机启动时自动执行的第一个程序，能够根据设置找到存储设备，进而找到启动管理程序。**
**2. MBR：主引导分区。位于第一个扇区，大小为64B，存放基本的启动管理程序。**
**3. 启动管理程序（boot loader）：目的是加载核心文件，是操作系统安装时放入的。**
**4. 核心文件：启动操作系统。**

# 启动管理程序

BIOS和MBR都是有硬件支持的，而启动管理程序就是安装在MBR上的一套软件，这个boot loader主要有以下几个功能。
**1. 提供菜单：使用者可以选择不同的启动项目。**
**2. 加载核心文件：直接指向可启动的程序区段来启动操作系统。**
**3. 转向其他loader：将启动管理功能交给其他loader负责。**

事实上，启动管理程序不仅仅可以安装在第一个扇区的MBR中，还可以安装在其他分区的启动扇区中，正是这个特色实现了多重引导的功能。如下图：
![cmd-markdown-logo](https://raw.githubusercontent.com/TsubasaBAKU/BLOGIMG/master/多重引导.png)
在上图中，windows和Linux操作系统分别被装在了两个不同的分区。假设MBR中的启动程序能够识别这两个操作系统，如果选择windows启动，那么该MBR中的boot loader就会直接加载windows的核心文件来启动windows系统；如果选择Linux启动，那么这个loader就会将启动任务交给另一个分区的loader来启动，而另一个loader只有一个菜单，所以直接加载核心文件来启动Linux系统。

我们做几点总结：
**1. 每个分区都有自己的启动扇区（boot sector）**
**2. 实际可启动的核心文件是放在对应的各个分区内的。**
**3. loader只会识别自己所在分区的核心文件，和其他的loader**
**4. loader可直接或者间接将启动权交给另一个loader。**

**为什么装两个系统时，先装Windows再装Linux呢？**
因为Linux在安装时，我们可以选择将启动管理程序装在MBR或者不同的boot loader中，而且Linux的loader可以让我们手动配置菜单，可以加入Windows的选项。
而Windows安装时，它会主动覆盖掉MBR和所在分区的启动扇区，所以原先的MBR中的启动程序就会被覆盖掉而且没有配置菜单的机会。